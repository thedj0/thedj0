<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Notes Comparison</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f4f4f4;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .notes {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
        }
        .note {
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            flex: 1;
            min-width: 0;
            max-width: 100%;
        }
        @media (max-width: 768px) {
            .notes {
                flex-direction: column;
                gap: 10px;
            }
        }
        .note h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Compare Case Notes</h1>
            <p>Compare three different case notes side-by-side.</p> 
        </div>
        <div class="notes">
            <div class="note">
                <h2>Handwritten Notes</h2> <hr>
                <strong>SCOPE</strong>
<br>
<strong>[Issue Description]:</strong> Customer has a job running on his automation account, which uses a managed identity and tries to access keyvault, however, it is failing with 503 error.
<br>
<strong>[Business Impact]:</strong> Medium, customer is unable to use the key and complete authentication.
<br>
<strong>[Expected Outcome]:</strong> Customer should be able to complete the authentication successfully using a MI.
<br><br>

<strong>CASE SUMMARY</strong>
<br>
<strong>[Environment]:</strong> Azure key vault with key, Azure Automation account which has the job running, managed identity
<br>
<strong>[Troubleshooting]:</strong> We checked the error and could see a forbidden 503 gateway error. Upon checking the network settings of the keyvault, we could see that customer has set the option to enable requests only from certain IP addresses and this job's IP address was not whitelisted. Customer wanted to use Azure Private Link, rather than whitelisting. This is supported from keyvault end, but as per documentation, Automation account doesn't support outbound requests to Azure Private Link services such as keyvault. <a href="https://learn.microsoft.com/en-us/azure/automation/how-to/private-link-security#limitations">https://learn.microsoft.com/en-us/azure/automation/how-to/private-link-security#limitations</a> Alternately, we can use Hybrid Runbook worker. So, I have engaged Automation support team to help us on the workaround.
<br><br>

<strong>ACTION PLAN</strong>
<br>
<strong>Case Status:</strong> Troubleshooting.
<br>
<strong>Next Action:</strong> Raise a collab with Automation team and discuss on the workaround
<br>
<strong>Next Contact:</strong> 6th August.

            </div>
            <div class="note">
                <h2>Notes generated by Tool using ChatGPT</h2><hr>
                <strong>Support Case Notes</strong>
<br><br>

<strong>SCOPE</strong>
<br>
<strong>Issue Description:</strong> Customer is receiving a 503 Forbidden error when trying to access a key in Azure Key Vault using a managed identity. The job runs from an Azure Automation account and fails consistently.
<br>
<strong>Business Impact:</strong> The inability to access the key in Azure Key Vault is preventing the customerâ€™s automated tasks from completing successfully, potentially leading to disruptions in critical business operations and workflow automation.
<br>
<strong>Expected Outcome:</strong> Resolution of the 503 Forbidden error, allowing the Azure Automation account to successfully access the key in Azure Key Vault using the managed identity, either through whitelisting the necessary IP addresses or implementing an alternative solution.
<br><br>

<strong>CASE SUMMARY</strong>
<br>
<strong>Environment:</strong>
<br>
Azure Key Vault: Configured with network settings to restrict access only to whitelisted IPs.
<br>
Azure Automation Account: Used to run jobs that require access to Azure Key Vault.
<br>
Managed Identity: Utilized for accessing the Azure Key Vault.
<br><br>

<strong>Troubleshooting:</strong>
<br>
Verified the error message received (503 Forbidden) when the job attempts to access Azure Key Vault.
<br>
Checked the network settings of Azure Key Vault and confirmed that only requests from whitelisted IP addresses are allowed.
<br>
Determined that the IP address of the Azure Automation account service was not whitelisted.
<br>
Customer wanted to use a different approach via Azure Private Link.
<br>
Reviewed Azure documentation and confirmed that Azure Automation accounts do not support outbound requests to Azure Private Link.
<br><br>

<strong>ACTION PLAN</strong>
<br>
<strong>Case Status:</strong> Troubleshooting
<br><br>

<strong>Next Action:</strong>
<br>
<strong>Whitelisting IP Addresses:</strong> Work with the customer to identify and whitelist the IP addresses used by the Azure Automation account. This can be done by adding the required IP addresses to the Azure Key Vault network settings.
<br>
<strong>Alternative Solution (Hybrid Runbook Worker):</strong> Collaborate with the Azure Automation team to implement a Hybrid Runbook Worker as a workaround. This will allow the job to run from a local or on-premises environment where network settings can be controlled more precisely.
<br>
Ensure that the Hybrid Runbook Worker has the necessary network access and permissions to interact with the Azure Key Vault.
<br><br>

<strong>Next Contact:</strong>
<br>
Scheduled follow-up with the customer within 24 hours to provide an update on the progress of IP whitelisting.
<br>
Additional contact to be scheduled upon confirmation from the Azure Automation team regarding the implementation of the Hybrid Runbook Worker.
<br><br>

<strong>Additional Notes:</strong>
<br>
A collaboration request has been raised with the Azure Automation team to assist with the Hybrid Runbook Worker workaround.
<br>
Documentation and steps for setting up the Hybrid Runbook Worker will be shared with the customer to ensure a smooth implementation process.
<br>
Continuous monitoring of the situation to ensure that the implemented solution resolves the issue without causing any additional disruptions.

            </div>
            <div class="note">
                <h2>Notes generated by Tool using Copilot</h2><hr>
                <strong>SUMMARY</strong>
<br><br>

<strong>SCOPE</strong>
<br>
<strong>Issue Description:</strong> Customer is getting a 503 forbidden error when they try to access a key in Azure Key Vault using a managed identity. This job is being run from an Azure Automation account and is failing.
<br>
<strong>Business Impact:</strong> The customer is unable to access critical keys in Azure Key Vault, which is affecting their operations and causing potential downtime.
<br>
<strong>Expected Outcome:</strong> The customer expects to be able to access the keys in Azure Key Vault without encountering the 503 forbidden error.
<br><br>

<strong>CASE SUMMARY</strong>
<br>
<strong>Environment:</strong> Azure Automation account, Azure Key Vault, Managed Identity.
<br>
<strong>Troubleshooting:</strong> Upon troubleshooting, it was found that the IP address of the automation account service was not whitelisted. As per the Key Vault network settings, only requests from whitelisted IPs can reach Key Vault. The customer wanted to use Azure Private Link, but Azure Automation account doesn't support outbound requests to Azure Private Link as per documentation.
<br><br>

<strong>ACTION PLAN</strong>
<br>
<strong>Case Status:</strong> Open
<br>
<strong>Next Action:</strong> Alternately, Hybrid runbook worker can be used and I have raised a collaboration with the Azure Automation team to help us on this workaround.
<br>
<strong>Next Contact:</strong> 6th August

            </div>
        </div>
    </div>
</body>
</html>
